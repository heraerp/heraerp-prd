#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ›¡ï¸ Running HERA Standardization Checks..."

# 1. Run HERA Standardization Checker
echo "ğŸ“‹ Running standardization validation..."
node scripts/hera-standardization-checker.js

# 2. Run ESLint with HERA rules
echo "ğŸ“ Running ESLint with HERA patterns..."
npx eslint --config .eslintrc.hera.js --fix .

# 3. Run TypeScript type checking
echo "ğŸ” Running TypeScript validation..."
npx tsc --noEmit

# 4. Validate Smart Codes
echo "ğŸ§¬ Validating Smart Code patterns..."
npm run validate:smart-codes

# 5. Check for missing organization_id
echo "ğŸ¢ Checking organization_id requirements..."
if grep -r "FROM core_entities" src/app/api --include="*.ts" | grep -v "organization_id"; then
  echo "âŒ Found database queries missing organization_id filter"
  exit 1
fi

# 6. Check for status columns (HERA violation)
echo "âš ï¸ Checking for status column violations..."
if grep -r "status.*varchar" database --include="*.sql" | grep -v "--"; then
  echo "âŒ Found status columns - use core_relationships instead"
  exit 1
fi

# 7. Validate API response formats
echo "ğŸ“¡ Checking API response formats..."
if grep -r "NextResponse.json" src/app/api --include="*.ts" | grep -v "success:" | head -5; then
  echo "âš ï¸ Warning: Some API responses may not follow standard format"
fi

echo "âœ… All standardization checks passed!"