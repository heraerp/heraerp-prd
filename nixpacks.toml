providers = ["node"]

[phases.setup]
# Use Node 20 channel from nixpkgs
nixPkgs = ["nodejs_20"]

[phases.install]
# Clear any existing cache and install dependencies
cmd = "rm -rf node_modules/.cache && npm ci --prefer-offline --no-audit --progress=false"

[phases.build]
# Build without cache interference
cmd = "rm -rf node_modules/.cache && npm run build"

[variables]
# Runtime version
NODE_VERSION = "20.18.0"
# Disable npm cache entirely to avoid conflicts
NPM_CONFIG_CACHE = "false"
NPM_CONFIG_UPDATE_NOTIFIER = "false"
NODE_OPTIONS = "--max-old-space-size=4096"
NEXT_TELEMETRY_DISABLED = "1"
