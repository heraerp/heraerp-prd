providers = ["node"]

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
# Skip install phase entirely
cmd = "echo 'Dependencies will be installed in build phase'"

[phases.build]
# Clean build without any cache conflicts
cmd = "rm -rf node_modules/.cache /app/.next/cache && npm ci --no-optional --prefer-offline --no-audit --progress=false --no-fund && npm run build"

[variables]
NODE_VERSION = "20.18.0"
NPM_CONFIG_UPDATE_NOTIFIER = "false"
NODE_OPTIONS = "--max-old-space-size=4096"
NEXT_TELEMETRY_DISABLED = "1"
RAILWAY_ENVIRONMENT = "true"
SKIP_ENV_VALIDATION = "true"
# Completely disable cache features
NIXPACKS_NO_CACHE = "true"
NPM_CONFIG_CACHE = "false"