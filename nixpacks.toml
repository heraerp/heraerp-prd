# HERA ERP Nixpacks Configuration
# Prevents Chromium/browser installation that was causing build timeouts
# Updated: Force new deployment trigger

[phases.setup]
nixPkgs = ["nodejs_20", "openssl"]

[phases.install]
# Install with dev deps for build (TypeScript needs them)
cmds = ["npm ci"]

[phases.build]
# Build with dev deps available
cmds = ["npm run build", "npm prune --omit=dev"]

[phases.start]
cmd = "npm start"

[variables]
# Next.js optimizations
NEXT_TELEMETRY_DISABLED = "1"
NODE_ENV = "production"

# ðŸš¨ CRITICAL: Skip browser downloads (fixes timeout issue)
PUPPETEER_SKIP_DOWNLOAD = "1"
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "1" 
PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD = "1"
PLAYWRIGHT_BROWSERS_PATH = "0"

# Prevent GUI dependencies
DISPLAY = ""
HEADLESS = "true"

# Performance optimizations
NODE_OPTIONS = "--max-old-space-size=4096"