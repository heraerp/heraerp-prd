# PUBLIC SECTOR CRM Entity Definitions
# ====================================
# Maps CRM concepts to HERA's Sacred Six tables with zero schema changes

metadata:
  industry: PUBLICSECTOR
  module: CRM
  version: v1
  description: "Entity definitions for public sector CRM on HERA foundation"
  created_at: "2024-01-01"
  updated_at: "2024-01-01"

# Core Entity Mappings
entities:
  # CONSTITUENT - Individual citizen or resident
  constituent:
    table: core_entities
    entity_type: constituent
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.CONSTITUENT.v1
    description: "Individual citizen or resident receiving public services"
    
    fields:
      # Core fields (stored in core_entities)
      entity_name: "Full legal name"
      entity_code: "National ID or unique identifier"
      
      # Dynamic fields (stored in core_dynamic_data)
      dynamic_fields:
        name:
          field_name: name
          field_type: text
          required: true
          description: "Full legal name"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.NAME.v1
          
        dob:
          field_name: dob
          field_type: text
          required: true
          description: "Date of birth (ISO format)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.DOB.v1
          
        national_id:
          field_name: national_id
          field_type: text
          required: false
          description: "National identification number"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.NID.v1
          
        address:
          field_name: address
          field_type: text
          required: false
          description: "Current residential address"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.ADDRESS.v1
          
        email:
          field_name: email
          field_type: text
          required: false
          description: "Email address"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.EMAIL.v1
          
        phone:
          field_name: phone
          field_type: text
          required: false
          description: "Phone number"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.PHONE.v1
          
        eligibility_flags:
          field_name: eligibility_flags
          field_type: json
          required: false
          description: "Program eligibility flags (JSON array)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.ELIGIBILITY.v1
          
        risk_score:
          field_name: risk_score
          field_type: number
          required: false
          description: "Risk assessment score (0-100)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CONSTITUENT.RISK.v1

  # PS_ORG - Public sector organization
  ps_org:
    table: core_entities
    entity_type: ps_org
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.ORG.v1
    description: "Public sector organization or department"
    
    fields:
      # Core fields
      entity_name: "Organization legal name"
      entity_code: "Registration number"
      
      # Dynamic fields
      dynamic_fields:
        legal_name:
          field_name: legal_name
          field_type: text
          required: true
          description: "Full legal name"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.ORG.NAME.v1
          
        registration_no:
          field_name: registration_no
          field_type: text
          required: true
          description: "Official registration number"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.ORG.REGNO.v1
          
        sector:
          field_name: sector
          field_type: text
          required: true
          description: "Organization sector (health, education, etc)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.ORG.SECTOR.v1
          
        address:
          field_name: address
          field_type: text
          required: false
          description: "Organization address"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.ORG.ADDRESS.v1
          
        contacts:
          field_name: contacts
          field_type: json
          required: false
          description: "Key contacts (JSON array)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.ORG.CONTACTS.v1

  # PROGRAM - Government program or initiative
  program:
    table: core_entities
    entity_type: program
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.PROGRAM.v1
    description: "Government program or initiative"
    
    fields:
      # Core fields
      entity_name: "Program title"
      entity_code: "Program code"
      
      # Dynamic fields
      dynamic_fields:
        code:
          field_name: code
          field_type: text
          required: true
          description: "Official program code"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.PROGRAM.CODE.v1
          
        title:
          field_name: title
          field_type: text
          required: true
          description: "Program title"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.PROGRAM.TITLE.v1
          
        description:
          field_name: description
          field_type: text
          required: false
          description: "Program description"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.PROGRAM.DESC.v1
          
        eligibility_rules:
          field_name: eligibility_rules
          field_type: json
          required: false
          description: "Eligibility rule configuration"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.PROGRAM.RULES.v1
          
        budget:
          field_name: budget
          field_type: number
          required: false
          description: "Total program budget"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.PROGRAM.BUDGET.v1

  # GRANT_ROUND - Specific grant funding round
  grant_round:
    table: core_entities
    entity_type: grant_round
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.GRANT_ROUND.v1
    description: "Specific grant funding round within a program"
    
    fields:
      # Core fields
      entity_name: "Grant round name"
      entity_code: "Round code"
      
      # Dynamic fields
      dynamic_fields:
        program_code:
          field_name: program_code
          field_type: text
          required: true
          description: "Parent program code"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.GRANT.PROGRAM.v1
          
        round_code:
          field_name: round_code
          field_type: text
          required: true
          description: "Grant round code"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.GRANT.ROUND.v1
          
        window_open:
          field_name: window_open
          field_type: text
          required: true
          description: "Application window open date"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.GRANT.OPEN.v1
          
        window_close:
          field_name: window_close
          field_type: text
          required: true
          description: "Application window close date"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.GRANT.CLOSE.v1
          
        kpis:
          field_name: kpis
          field_type: json
          required: false
          description: "Key performance indicators"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.GRANT.KPI.v1

  # CASE - Service case or inquiry
  case:
    table: core_entities
    entity_type: case
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.CASE.v1
    description: "Service case or citizen inquiry"
    
    fields:
      # Core fields
      entity_name: "Case title"
      entity_code: "Case number"
      
      # Dynamic fields
      dynamic_fields:
        subject_entity_id:
          field_name: subject_entity_id
          field_type: text
          required: true
          description: "Entity ID of case subject"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CASE.SUBJECT.v1
          
        category:
          field_name: category
          field_type: text
          required: true
          description: "Case category"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CASE.CATEGORY.v1
          
        priority:
          field_name: priority
          field_type: text
          required: true
          description: "Case priority (low/medium/high/critical)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CASE.PRIORITY.v1
          
        sla_seconds:
          field_name: sla_seconds
          field_type: number
          required: true
          description: "SLA in seconds"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CASE.SLA.v1
          
        current_status:
          field_name: current_status
          field_type: text
          required: false
          description: "Current case status"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.CASE.STATUS.v1

  # COMM_TEMPLATE - Communication template
  comm_template:
    table: core_entities
    entity_type: comm_template
    smart_code: HERA.PUBLICSECTOR.CRM.ENTITY.COMM_TEMPLATE.v1
    description: "Reusable communication template"
    
    fields:
      # Core fields
      entity_name: "Template name"
      entity_code: "Template code"
      
      # Dynamic fields
      dynamic_fields:
        channel:
          field_name: channel
          field_type: text
          required: true
          description: "Communication channel (email/sms/letter)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.COMM.CHANNEL.v1
          
        subject:
          field_name: subject
          field_type: text
          required: false
          description: "Message subject (for email)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.COMM.SUBJECT.v1
          
        body:
          field_name: body
          field_type: text
          required: true
          description: "Message body template"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.COMM.BODY.v1
          
        placeholders:
          field_name: placeholders
          field_type: json
          required: false
          description: "Available placeholders (JSON array)"
          smart_code: HERA.PUBLICSECTOR.CRM.DYN.COMM.PLACEHOLDERS.v1

# Playbook Definitions (as entities)
playbook_definitions:
  grant_management:
    table: core_entities
    entity_type: playbook_def
    entity_name: "Grant Management Workflow"
    entity_code: "GRANT_MGMT_v1"
    smart_code: HERA.PUBLICSECTOR.CRM.PLAYBOOK.DEF.GRANT_MGMT.v1
    
    metadata:
      description: "End-to-end grant management workflow"
      category: grant_processing
      avg_duration_days: 30
      
  case_resolution:
    table: core_entities
    entity_type: playbook_def
    entity_name: "Case Resolution Workflow"
    entity_code: "CASE_RESOLVE_v1"
    smart_code: HERA.PUBLICSECTOR.CRM.PLAYBOOK.DEF.CASE_RESOLVE.v1
    
    metadata:
      description: "Standard case resolution workflow"
      category: service_delivery
      avg_duration_days: 7
      
  citizen_onboarding:
    table: core_entities
    entity_type: playbook_def
    entity_name: "Citizen Onboarding Workflow"
    entity_code: "CITIZEN_ONBOARD_v1"
    smart_code: HERA.PUBLICSECTOR.CRM.PLAYBOOK.DEF.CITIZEN_ONBOARD.v1
    
    metadata:
      description: "New citizen registration and onboarding"
      category: registration
      avg_duration_days: 1

# Relationship Mappings
relationships:
  # Program to Grant Round
  program_has_grant_round:
    table: core_relationships
    relationship_type: has_grant_round
    smart_code: HERA.PUBLICSECTOR.CRM.PROGRAM.HAS_GRANT_ROUND
    from_entity_type: program
    to_entity_type: grant_round
    
  # Case to Subject
  case_has_subject:
    table: core_relationships
    relationship_type: has_subject
    smart_code: HERA.PUBLICSECTOR.CRM.CASE.SUBJECT
    from_entity_type: case
    to_entity_type: [constituent, ps_org]
    
  # Organization sponsors Program
  org_sponsors_program:
    table: core_relationships
    relationship_type: sponsors
    smart_code: HERA.PUBLICSECTOR.CRM.ORG.SPONSORS_PROGRAM
    from_entity_type: ps_org
    to_entity_type: program

# Transaction Mappings
transactions:
  grant_application:
    table: universal_transactions
    transaction_type: grant_application
    smart_code: HERA.PUBLICSECTOR.CRM.TXN.GRANT_APPLICATION.v1
    description: "Grant application submission"
    
    required_fields:
      - from_entity_id  # Applicant (constituent or ps_org)
      - to_entity_id    # Grant round
      - total_amount    # Requested amount
      
    metadata_fields:
      - application_date
      - project_description
      - supporting_documents
      
  case_creation:
    table: universal_transactions
    transaction_type: case_create
    smart_code: HERA.PUBLICSECTOR.CRM.TXN.CASE_CREATE.v1
    description: "New case creation"
    
    required_fields:
      - from_entity_id  # Case entity
      - to_entity_id    # Subject entity
      
    metadata_fields:
      - category
      - priority
      - initial_description
      
  communication_sent:
    table: universal_transactions
    transaction_type: communication
    smart_code: HERA.PUBLICSECTOR.CRM.TXN.COMM_SENT.v1
    description: "Communication sent to constituent"
    
    required_fields:
      - from_entity_id  # Sender (ps_org)
      - to_entity_id    # Recipient (constituent)
      
    metadata_fields:
      - template_id
      - channel
      - sent_at
      - delivery_status

# Playbook Run Mappings
playbook_runs:
  grant_management_run:
    table: universal_transactions
    transaction_type: playbook_run
    smart_code: HERA.PUBLICSECTOR.CRM.PLAYBOOK.RUN.GRANT_MGMT.v1
    description: "Grant management workflow execution"
    
    metadata_fields:
      - grant_application_id
      - decision
      - approved_amount
      
  case_resolution_run:
    table: universal_transactions
    transaction_type: playbook_run
    smart_code: HERA.PUBLICSECTOR.CRM.PLAYBOOK.RUN.CASE_RESOLVE.v1
    description: "Case resolution workflow execution"
    
    metadata_fields:
      - case_id
      - resolution_type
      - resolution_notes

# Integration Points
integrations:
  identity_verification:
    description: "External identity verification service"
    endpoint_pattern: "/api/v1/verify/identity"
    
  document_storage:
    description: "Document management system"
    endpoint_pattern: "/api/v1/documents"
    
  notification_service:
    description: "Multi-channel notification service"
    endpoint_pattern: "/api/v1/notifications"
    
  analytics_platform:
    description: "Business intelligence and reporting"
    endpoint_pattern: "/api/v1/analytics"