# ============================================================================
# HERA Universal Transactions App Configuration
# Generates adaptive transaction pages for all business modules
# ============================================================================

app:
  id: universal-transactions
  name: "Universal Transactions"
  description: "Modern 4-step wizard for all non-journal transactions"
  version: "2.0.0"
  category: "Finance & Operations"
  
  # Smart Code patterns
  smart_codes:
    - "HERA.FINANCE.TXN.SALE.v1"
    - "HERA.FINANCE.TXN.EXPENSE.v1" 
    - "HERA.INVENTORY.TXN.RECEIPT.v1"
    - "HERA.INVENTORY.TXN.ISSUE.v1"
    - "HERA.FINANCE.TXN.RETURN.v1"

# Core transaction types supported
transaction_types:
  - id: sale
    label: "Sales Transaction"
    smart_code: "HERA.FINANCE.TXN.SALE.v1"
    description: "POS sales, invoices, and revenue recognition"
    icon: "ShoppingCart"
    color: "green"
    party_type: "CUSTOMER"
    posting_bundle: "finance_dna_v2_2_sales"
    line_types:
      - ITEM_LINE
      - SERVICE_LINE
      - CHARGE_LINE
      - PAYMENT_LINE
    
  - id: purchase
    label: "Purchase Transaction"
    smart_code: "HERA.FINANCE.TXN.EXPENSE.v1"
    description: "AP invoices, procurement, and expense management"
    icon: "Receipt"
    color: "blue"
    party_type: "VENDOR"
    posting_bundle: "finance_dna_v2_2_purchase"
    line_types:
      - ITEM_LINE
      - SERVICE_LINE
      - CHARGE_LINE
      - EXPENSE_LINE
    
  - id: goods_receipt
    label: "Goods Receipt"
    smart_code: "HERA.INVENTORY.TXN.RECEIPT.v1"
    description: "Inventory receiving and stock management"
    icon: "Package"
    color: "purple"
    party_type: "SUPPLIER"
    posting_bundle: "inventory_dna_v2_2_receipt"
    line_types:
      - ITEM_LINE
      - CHARGE_LINE
    
  - id: goods_issue
    label: "Goods Issue"
    smart_code: "HERA.INVENTORY.TXN.ISSUE.v1"
    description: "Inventory issuing and stock outbound"
    icon: "Truck"
    color: "orange"
    party_type: "CUSTOMER"
    posting_bundle: "inventory_dna_v2_2_issue"
    line_types:
      - ITEM_LINE
      - CHARGE_LINE
    
  - id: return
    label: "Return Transaction"
    smart_code: "HERA.FINANCE.TXN.RETURN.v1"
    description: "Sales returns and purchase returns"
    icon: "ArrowRightLeft"
    color: "red"
    party_type: "CUSTOMER_OR_VENDOR"
    posting_bundle: "finance_dna_v2_2_return"
    line_types:
      - ITEM_LINE
      - SERVICE_LINE
      - CHARGE_LINE
      - PAYMENT_LINE

# Transaction line types configuration
line_types:
  ITEM_LINE:
    label: "Item"
    smart_code: "HERA.SALES.LINE.ITEM.v1"
    icon: "Package"
    color: "blue"
    fields:
      - entity_id      # Product/Item reference
      - quantity       # Quantity sold/purchased
      - unit_amount    # Unit price
      - discount_amount
      - tax_amount
      - line_amount    # Extended amount
      
  SERVICE_LINE:
    label: "Service"
    smart_code: "HERA.SALES.LINE.SERVICE.v1"
    icon: "Users"
    color: "green"
    fields:
      - entity_id      # Service reference
      - quantity       # Hours/sessions
      - unit_amount    # Hourly rate
      - tax_amount
      - line_amount
      
  CHARGE_LINE:
    label: "Charge"
    smart_code: "HERA.FINANCE.LINE.CHARGE.v1"
    icon: "DollarSign"
    color: "orange"
    fields:
      - description    # Freight, handling, etc.
      - line_amount
      - tax_amount
      
  PAYMENT_LINE:
    label: "Payment"
    smart_code: "HERA.CASH.LINE.PAYMENT.v1"
    icon: "CreditCard"
    color: "purple"
    fields:
      - line_amount    # Payment amount
      - method         # CASH, CARD, BANK
      - reference      # Auth code, check number
      
  EXPENSE_LINE:
    label: "Expense"
    smart_code: "HERA.PURCHASE.LINE.EXPENSE.v1"
    icon: "Receipt"
    color: "red"
    fields:
      - entity_id      # GL account reference
      - line_amount
      - tax_amount

# Data contract schema
schema:
  header:
    table: "universal_transactions"
    required_fields:
      - organization_id
      - transaction_type
      - smart_code
      - transaction_date
      - transaction_currency_code
      - base_currency_code
      - exchange_rate
      - fiscal_year
      - fiscal_period
    optional_fields:
      - source_entity_id     # Customer/Vendor
      - target_entity_id     # Company/Branch
      - business_context     # JSON context data
      - metadata            # External references
      
  lines:
    table: "universal_transaction_lines"
    required_fields:
      - line_number
      - line_type
      - smart_code
      - line_amount
    optional_fields:
      - entity_id           # Product/Service/Account
      - quantity
      - unit_amount
      - discount_amount
      - tax_amount
      - description
      - line_data          # Dimensions, tax details

# Guardrails configuration
guardrails:
  smart_code:
    pattern: "^HERA\\.[A-Z]+\\.[A-Z]+\\.[A-Z]+\\.v\\d+$"
    required: true
    
  organization_filter:
    required: true
    field: "organization_id"
    
  gl_balance:
    required_for_gl_lines: true
    balance_per_currency: true
    
  audit_trail:
    actor_stamping: true
    required_fields:
      - created_by
      - updated_by
      - created_at
      - updated_at

# Posting rules integration
posting:
  rpc_function: "hera_transactions_post_v2"
  fallback_rpc: "hera_transactions_post_v1"
  idempotency: true
  
  # Policy bundles for different transaction types
  bundles:
    finance_dna_v2_2_sales:
      rules:
        - match: "HERA.FINANCE.TXN.SALE.v1"
          gl_lines:
            - side: "DR"
              account_code: "1000"  # Cash/AR
              amount_expr: "gross_total"
            - side: "CR" 
              account_code: "4000"  # Revenue
              amount_expr: "net_of_tax"
            - side: "CR"
              account_code: "2100"  # VAT Payable
              amount_expr: "tax_total"
              
    finance_dna_v2_2_purchase:
      rules:
        - match: "HERA.FINANCE.TXN.EXPENSE.v1"
          gl_lines:
            - side: "DR"
              account_code: "5000"  # Expense
              amount_expr: "net_of_tax" 
            - side: "DR"
              account_code: "1410"  # VAT Recoverable
              amount_expr: "tax_total"
            - side: "CR"
              account_code: "2101"  # AP
              amount_expr: "gross_total"

# UI/UX configuration
ui:
  wizard_steps:
    - id: "header"
      label: "Header"
      icon: "FileText"
      description: "Transaction basic information"
      
    - id: "lines"
      label: "Lines"  
      icon: "BarChart3"
      description: "Transaction line items"
      
    - id: "validate"
      label: "Validate"
      icon: "CheckCircle2"
      description: "Validation and preview"
      
    - id: "post"
      label: "Post"
      icon: "Send"
      description: "Final posting"
      
  responsive_design:
    mobile_first: true
    breakpoints:
      mobile: "< 768px"
      tablet: "768px - 1024px"
      desktop: "> 1024px"
      
  colors:
    primary: "blue-600"
    success: "green-600"
    warning: "yellow-600"
    danger: "red-600"
    
# Pages to generate
pages:
  - path: "/universal/transactions/sales"
    component: "SalesTransactionPage"
    mode: "sale"
    title: "Sales Transaction"
    description: "Point of Sale & Invoice Processing"
    
  - path: "/universal/transactions/purchase"
    component: "PurchaseTransactionPage"
    mode: "purchase"
    title: "Purchase Transaction"
    description: "Accounts Payable & Procurement"
    
  - path: "/universal/transactions/goods-receipt"
    component: "GoodsReceiptPage"
    mode: "goods_receipt"
    title: "Goods Receipt"
    description: "Inventory Receiving"
    
  - path: "/universal/transactions/goods-issue"
    component: "GoodsIssuePage"
    mode: "goods_issue"
    title: "Goods Issue"
    description: "Inventory Issuing"
    
  - path: "/universal/transactions/returns"
    component: "ReturnTransactionPage"
    mode: "return"
    title: "Return Transaction"
    description: "Sales & Purchase Returns"

# Integration with existing modules
integration:
  modules:
    - finance
    - inventory
    - sales
    - procurement
    - pos
    
  navigation:
    enterprise:
      - section: "Finance"
        items:
          - name: "Sales Transactions"
            href: "/universal/transactions/sales"
            icon: "ShoppingCart"
          - name: "Purchase Transactions"
            href: "/universal/transactions/purchase"
            icon: "Receipt"
            
      - section: "Inventory"
        items:
          - name: "Goods Receipt"
            href: "/universal/transactions/goods-receipt"
            icon: "Package"
          - name: "Goods Issue"
            href: "/universal/transactions/goods-issue"
            icon: "Truck"

# Testing configuration
testing:
  unit_tests:
    - component: "UniversalTransaction"
      scenarios:
        - "Sales transaction creation"
        - "Purchase transaction with multi-currency"
        - "Goods receipt with quality control"
        - "Guardrails validation"
        - "GL posting integration"
        
  integration_tests:
    - "End-to-end sales flow"
    - "Multi-currency purchase flow"
    - "Inventory receipt to issue flow"
    - "Return transaction processing"
    
  performance_tests:
    - "Large transaction line handling"
    - "Concurrent user transactions"
    - "Real-time validation response"

# Deployment configuration
deployment:
  environments:
    - development
    - staging
    - production
    
  feature_flags:
    - name: "universal_transactions_enabled"
      default: true
    - name: "multi_currency_support"
      default: true
    - name: "real_time_validation"
      default: true
      
  monitoring:
    metrics:
      - transaction_creation_time
      - validation_success_rate
      - posting_success_rate
      - user_completion_rate
    
    alerts:
      - high_error_rate
      - slow_response_time
      - validation_failures

# Documentation
documentation:
  user_guide: "/docs/universal-transactions/user-guide.md"
  api_reference: "/docs/universal-transactions/api-reference.md"
  developer_guide: "/docs/universal-transactions/developer-guide.md"
  troubleshooting: "/docs/universal-transactions/troubleshooting.md"